<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>L√§rarportal</title>
  <link rel="stylesheet" href="lararportal.css" />
</head>
<body>
  <header>
    <div class="title">L√§rarportal</div>
    <div class="header-right">
      <span>Inloggad som: L√§rare</span>
      <button class="logout-btn" onclick="logout()">Logga ut</button>
    </div>
  </header>
 
  <main>
    <section class="grading-section">
      <div class="section-header">
        <h2>Betygss√§ttning</h2>
        <button class="schema-btn" onclick="openSchedule()">üìÖ Visa schema</button>
      </div>

      <div class="grading-form">
        <select id="student-select">
          <option selected disabled>V√§lj elev</option>
          <!-- 15 elever -->
          <option>Sara Nor√©n</option>
          <option>Ushindi Isaac Bauma</option>
          <option>Alexander Larsson</option>
          <option>Kamyar Xailani</option>
          <option>Marcus Rydell</option>
          <option>Darin Twana</option>
          <option>Simon Caryll</option>
          <option>Enlil Haddad</option>
          <option>Stefan Horn</option>
          <option>Karl Cederl√∂f</option>
          <option>Morgan Emet</option>
          <option>Mattias nilsson</option>
          <option>Max Jokela</option>
          <option>Oliver Ullbrand</option>
          <option>Johan Carlson</option>
        </select>
 
        <select id="course-select">
          <option selected disabled>V√§lj kurs</option>
          <option>Molntj√§nster</option>
          <option>Matte</option>
          <option>C++</option>
          <option>Cybers√§kerhet</option>
          <option>N√§tverksteknik</option>
          <option>EL-l√§ra</option>
        </select>
 
        <div class="grades">
          <button class="grade-btn" onclick="selectGrade('IG')">IG</button>
          <button class="grade-btn" onclick="selectGrade('G')">G</button>
          <button class="grade-btn" onclick="selectGrade('VG')">VG</button>
        </div>
 
        <input type="text" placeholder="Skriv kommentarer h√§r..." class="comment-box" id="comment-box"/>
 
        <button class="save-btn" onclick="saveGrade()">Spara betyg</button>
      </div>
 
      <hr />
 
      <h3>Senaste betygen</h3>
      <table id="grades-table">
        <thead>
          <tr>
            <th>Elev</th>
            <th>Kurs</th>
            <th>Betyg</th>
            <th>Kommentarer</th>
            <th>Datum</th>
            <th>Redigera</th>
            <th>Ta bort</th>
          </tr>
        </thead>
        <tbody>
          <!-- Dynamiskt fylld med JavaScript -->
        </tbody>
      </table>
    </section>
  </main>

  <script>
    // Logout funktion f√∂r att √•terv√§nda till index.html
    function logout() {
      window.location.href = "index.html"; // √Öterg√• till startsidan
    }

    // Funktion f√∂r att √∂ppna schema i nytt f√∂nster
    function openSchedule() {
      window.open('https://web.skola24.se/timetable/timetable-viewer/arboga.skola24.se/H%C3%B6gskolecentrum/', '_blank');
    }

    // Funktion f√∂r att markera den valda betygsknappen
    function selectGrade(grade) {
      const gradeButtons = document.querySelectorAll('.grade-btn');
      gradeButtons.forEach(button => {
        button.classList.remove('selected'); // Ta bort 'selected' fr√•n alla knappar
      });
      const selectedButton = [...gradeButtons].find(button => button.textContent === grade);
      if (selectedButton) {
        selectedButton.classList.add('selected'); // L√§gg till 'selected' p√• den valda knappen
      }
    }

    // Funktion f√∂r att spara betyg och visa i tabellen
    function saveGrade() {
      const student = document.getElementById('student-select').value;
      const course = document.getElementById('course-select').value;
      const gradeButton = document.querySelector('.grade-btn.selected');
      const grade = gradeButton ? gradeButton.textContent : '';
      const comment = document.getElementById('comment-box').value;

      if (student && course && grade) {
        const date = new Date().toISOString().split('T')[0]; // Format: YYYY-MM-DD
        const table = document.getElementById('grades-table').getElementsByTagName('tbody')[0];
        const newRow = table.insertRow(0); // L√§gg till nya betyget h√∂gst upp i tabellen
        
        // L√§gg till data-attribut f√∂r mobilvyn
        newRow.innerHTML = `<td data-column="Elev">${student}</td>
                            <td data-column="Kurs">${course}</td>
                            <td data-column="Betyg">${grade}</td>
                            <td data-column="Kommentarer">${comment}</td>
                            <td data-column="Datum">${date}</td>
                            <td data-column="Redigera"><button class="edit-btn" onclick="editGrade(this)">‚úèÔ∏è</button></td>
                            <td data-column="Ta bort"><button class="delete-btn" onclick="deleteRow(this)">üóëÔ∏è</button></td>`;

        // Rensa formul√§rf√§lt efter sparande
        document.getElementById('student-select').selectedIndex = 0;
        document.getElementById('course-select').selectedIndex = 0;
        document.getElementById('comment-box').value = '';
        document.querySelectorAll('.grade-btn').forEach(button => button.classList.remove('selected')); // Ta bort all selektion
      } else {
        alert("Fyll i alla f√§lt innan du sparar betyget!");
      }
    }

    // Funktion f√∂r att redigera betygsraden
    function editGrade(button) {
      const row = button.closest('tr');
      const cells = row.querySelectorAll('td');
      
      // G√∂r cellerna redigerbara
      cells.forEach(cell => {
        if (cell.hasAttribute('data-column') && 
            !cell.getAttribute('data-column').includes('Redigera') && 
            !cell.getAttribute('data-column').includes('Ta bort')) {
          const currentValue = cell.textContent;
          const column = cell.getAttribute('data-column');
          
          if (column === "Betyg") {
            const select = document.createElement("select");
            ["IG", "G", "VG"].forEach(grade => {
              const option = document.createElement("option");
              option.value = grade;
              option.textContent = grade;
              if (grade === currentValue) option.selected = true;
              select.appendChild(option);
            });
            cell.innerHTML = '';
            cell.appendChild(select);
          } else if (column === "Elev" || column === "Kurs") {
            const input = document.createElement("input");
            input.type = "text";
            input.value = currentValue;
            input.style.width = "100%";
            cell.innerHTML = '';
            cell.appendChild(input);
          } else if (column === "Kommentarer") {
            const input = document.createElement("input");
            input.type = "text";
            input.value = currentValue;
            input.style.width = "100%";
            cell.innerHTML = '';
            cell.appendChild(input);
          }
        }
      });

      // Byt ut redigeringsknappen mot en spara-knapp
      button.textContent = 'üíæ';
      button.setAttribute('onclick', 'saveEdit(this)');
    }

    // Funktion f√∂r att spara redigerad betygsrad
    function saveEdit(button) {
      const row = button.closest('tr');
      const cells = row.querySelectorAll('td');

      cells.forEach(cell => {
        if (cell.hasAttribute('data-column') && 
            !cell.getAttribute('data-column').includes('Redigera') && 
            !cell.getAttribute('data-column').includes('Ta bort')) {
          const input = cell.querySelector('input') || cell.querySelector('select');
          if (input) {
            cell.textContent = input.value;
          }
        }
      });

      // Byt tillbaka till redigeringsknapp
      button.textContent = '‚úèÔ∏è';
      button.setAttribute('onclick', 'editGrade(this)');
    }

    // Funktion f√∂r att ta bort betygsrad
    function deleteRow(button) {
      const row = button.closest('tr');
      row.remove(); // Tar bort hela raden fr√•n tabellen
    }
  </script>
</body>
</html>